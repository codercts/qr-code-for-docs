<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>QR Code Generator</title>
  <link rel="icon" type="image/png" href="/assets/images/logo.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <!-- QRious library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
  <style>
    /* Basic page styles */
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #6d5dff, #5f6e88);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      margin: 0;
      color: white;
      text-align: center;
    }

    nav {
      width: 100%;
      background-color: rgba(255, 255, 255, 0.1);
      padding: 15px;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1000;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    nav ul {
      list-style-type: none;
      padding: 0;
      display: flex;
    }

    nav ul li {
      margin: 0 15px;
    }

    nav ul li a {
      color: white;
      text-decoration: none;
      font-size: 18px;
      transition: color 0.3s;
    }

    nav ul li a:hover {
      color: #ffcc00;
    }

    .hamburger {
      display: none;
      flex-direction: column;
      cursor: pointer;
    }

    .line {
      height: 3px;
      width: 30px;
      background-color: white;
      margin: 3px 0;
    }

    .main {
      display: flex;
      flex: 1;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      margin-top: 80px;
      transition: margin-bottom 0.3s;
    }

    .qr-code-container {
      background: rgba(255, 255, 255, 0.1);
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      width: 350px;
      position: relative;
    }

    h1 {
      margin-bottom: 20px;
    }

    #qrCanvas {
      border: 2px solid #ffffff;
      border-radius: 8px;
      margin-top: 10px;
      background-color: #ffffff;
      display: none;
      margin-left: auto;
      margin-right: auto;
    }

    #dropArea {
      width: 100%;
      height: 100px;
      border: 2px dashed rgba(255, 255, 255, 0.8);
      border-radius: 8px;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 20px;
      cursor: pointer;
      background-color: rgba(255, 255, 255, 0.2);
      transition: background-color 0.3s;
    }

    #dropArea:hover {
      background-color: rgba(255, 255, 255, 0.3);
    }

    textarea {
      width: 100%;
      border: none;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 15px;
      resize: none;
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
    }

    textarea::placeholder {
      color: rgba(255, 255, 255, 0.7);
    }

    button {
      background: linear-gradient(90deg, #6d5dff, #5f6e88);
      border: none;
      color: white;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      transition: background 1.5s;
      font-size: 16px;
    }

    button:hover {
      background: linear-gradient(90deg, #5f6e88, #6d5dff);
    }

    footer {
      width: 100%;
      background: rgba(255, 255, 255, 0.1);
      padding: 10px;
      position: fixed;
      bottom: -200px;
      left: 0;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.3);
      color: white;
      display: flex;
      justify-content: center;
      flex-direction: column;
      align-items: center;
      transition: bottom 1.5s;
    }

    footer.visible {
      bottom: 0;
    }

    footer p {
      margin: 5px 0;
    }

    footer .social-icons {
      display: flex;
      justify-content: center;
      margin-top: 5px;
    }

    footer .social-icons a {
      color: white;
      margin: 0 10px;
      font-size: 30px;
      padding: 5px;
      transition: background 0.3s, color 0.3s;
    }

    footer .social-icons a:hover {
      color: #ffcc00;
    }

    .about-container,
    .contact-container {
      padding: 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      margin: 20px 0;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }

    /* Hamburger Menu Styling */
    #navMenu {
      display: none;
      flex-direction: column;
    }

    #navMenu.show {
      display: flex;
    }

    @media (min-width: 600px) {
      .hamburger {
        display: none;
      }

      #navMenu {
        display: flex;
        flex-direction: row;
      }
    }
  </style>
</head>
<body>
  <nav>
    <div class="hamburger" id="hamburger">
      <div class="line"></div>
      <div class="line"></div>
      <div class="line"></div>
    </div>
    <ul id="navMenu">
      <li><a href="#home" onclick="showPage('qrCodePage')">Home</a></li>
      <li><a href="#about" onclick="showPage('aboutPage')">About</a></li>
      <li><a href="#contact" onclick="showPage('contactPage')">Contact</a></li>
      <li><a href="#explore" onclick="showPage('explorePage')">Explore</a></li>
    </ul>
  </nav>

  <div class="main">
    <div id="qrCodePage" class="qr-code-container">
      <h1>QR Code Generator</h1>
      <div id="dropArea">Drag &amp; Drop Text, PDFs, or Word Files Here</div>
      <textarea id="qrInput" class="form-control" placeholder="Paste text or URL here" rows="3"></textarea>
      <button id="generateQr" class="btn btn-primary mt-2">Generate QR Code</button>
      <input type="file" id="fileInput" style="display:none;" />
      <button id="browseFiles" class="btn btn-secondary mt-2">Browse Files</button>
      <canvas id="qrCanvas" width="150" height="150"></canvas>
      <div id="downloadContainer" style="display:none; margin-top: 20px;">
        <button id="downloadQr" class="btn btn-success">Download QR Code</button>
      </div>
    </div>

    <div id="aboutPage" class="about-container" style="display:none;">
      <h1>About Us</h1>
      <p>Welcome to our QR Code Generator! We are a dedicated team of developers passionate about providing tools that make life easier and more efficient.</p>
      <p>Our QR Code Generator allows you to create custom QR codes for any text or URL. Whether you're promoting a business, sharing contact information, or creating unique experiences, we've got you covered!</p>
      <p>Thank you for using our service!</p>
    </div>

    <div id="contactPage" class="contact-container" style="display:none;">
      <h1>Contact Us</h1>
      <p>You can reach us through the following platforms:</p>
      <p>
        <a href="https://www.instagram.com/span.iard._" target="_blank"><i class="fab fa-instagram"></i> Instagram</a>
      </p>
      <p>
        <a href="https://github.com/ebrainedtech" target="_blank"><i class="fab fa-github"></i> GitHub</a>
      </p>
      <p>
        <a href="https://wa.me/254705743454" target="_blank"><i class="fab fa-whatsapp"></i> WhatsApp</a>
      </p>
      <p>Location: Nairobi, Ruaka</p>
    </div>

    <div id="explorePage" class="explore-container" style="display:none;">
      <h1>Explore</h1>
      <p>Discover more features and functionalities here.</p>
    </div>
  </div>

  <footer id="footer">
    <p>&copy; 2024 QR Code Generator. All Rights Reserved.</p>
    <div class="social-icons">
      <a href="https://www.instagram.com/span.iard._" target="_blank"><i class="fab fa-instagram"></i></a>
      <a href="https://github.com/ebrainedtech" target="_blank"><i class="fab fa-github"></i></a>
      <a href="https://wa.me/254705743454" target="_blank"><i class="fab fa-whatsapp"></i></a>
    </div>
  </footer>

  <script>
    // --- CONFIGURATION ---
    // Set your Google Drive OAuth 2.0 access token here.
    // For production, implement a proper OAuth flow instead of hardcoding a token.
    const accessToken = 'YOUR_ACCESS_TOKEN';

    // --- ELEMENT REFERENCES ---
    const qrInput = document.getElementById('qrInput');
    const generateQr = document.getElementById('generateQr');
    const qrCanvas = document.getElementById('qrCanvas');
    const downloadQr = document.getElementById('downloadQr');
    const footer = document.getElementById('footer');
    const hamburger = document.getElementById('hamburger');
    const navMenu = document.getElementById('navMenu');
    const dropArea = document.getElementById('dropArea');
    const downloadContainer = document.getElementById('downloadContainer');
    const fileInput = document.getElementById('fileInput');
    const browseFiles = document.getElementById('browseFiles');

    // --- INITIALIZE QRious ---
    const qr = new QRious({
      element: qrCanvas,
      size: 150,
      value: ''
    });

    // --- HELPER FUNCTIONS ---

    /**
     * Updates the QR code with the provided URL or text.
     * Hides the input and drop area, and shows the QR code and download button.
     * @param {string} url - The URL or text to encode in the QR code.
     */
    function updateQRCode(url) {
      qr.value = url;
      qrCanvas.style.display = 'block';
      downloadContainer.style.display = 'block';
      dropArea.style.display = 'none';
      qrInput.style.display = 'none';
      generateQr.style.display = 'none';
    }

    /**
     * Uploads a file to Google Drive using the Drive API.
     * Sets the file permission to public (anyone with the link can view).
     * Returns a direct download link for the file.
     * @param {File} file - The file to upload.
     * @returns {Promise<string|null>} - The public download URL, or null on error.
     */
    async function uploadFileToDrive(file) {
      if (!accessToken || accessToken === 'YOUR_ACCESS_TOKEN') {
        alert('Google Drive access token is not set.');
        return null;
      }

      const metadata = {
        name: file.name,
        mimeType: file.type
      };

      const formData = new FormData();
      formData.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
      formData.append('file', file);

      try {
        // Upload the file
        const uploadResponse = await fetch(
          'https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart',
          {
            method: 'POST',
            headers: {
              Authorization: `Bearer ${accessToken}`
            },
            body: formData
          }
        );
        const uploadResult = await uploadResponse.json();

        if (!uploadResponse.ok) {
          console.error('Error uploading file:', uploadResult);
          alert('Error uploading file to Google Drive.');
          return null;
        }

        // Set file permission to "anyone with the link" (public)
        const permissionResponse = await fetch(
          `https://www.googleapis.com/drive/v3/files/${uploadResult.id}/permissions`,
          {
            method: 'POST',
            headers: {
              Authorization: `Bearer ${accessToken}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              role: 'reader',
              type: 'anyone'
            })
          }
        );
        const permissionResult = await permissionResponse.json();
        if (!permissionResponse.ok) {
          console.error('Error setting permission:', permissionResult);
          alert('Error setting file permissions.');
          return null;
        }

        // Create a direct download link for the file
        const publicLink = `https://drive.google.com/uc?id=${uploadResult.id}&export=download`;
        return publicLink;
      } catch (error) {
        console.error('Upload failed:', error);
        alert('An error occurred while uploading the file.');
        return null;
      }
    }

    // --- EVENT LISTENERS ---

    // Generate QR code manually when clicking the "Generate QR Code" button.
    generateQr.addEventListener('click', () => {
      const url = qrInput.value.trim();
      if (url) {
        updateQRCode(url);
        browseFiles.style.display = 'none';
      } else {
        alert('Please enter a valid text or URL.');
      }
    });

    // Download the QR code as an image.
    downloadQr.addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'qr-code.png';
      link.href = qrCanvas.toDataURL();
      link.click();
    });

    // Drag and drop styling
    dropArea.addEventListener('dragover', (event) => {
      event.preventDefault();
      dropArea.style.backgroundColor = 'rgba(255, 255, 255, 0.3)';
    });

    dropArea.addEventListener('dragleave', () => {
      dropArea.style.backgroundColor = 'rgba(255, 255, 255, 0.2)';
    });

    // Handle file drop
    dropArea.addEventListener('drop', async (event) => {
      event.preventDefault();
      dropArea.style.backgroundColor = 'rgba(255, 255, 255, 0.2)';
      const files = event.dataTransfer.files;
      if (files.length > 0) {
        const file = files[0];

        // For PDF or Word documents, upload to Google Drive
        if (
          file.type === "application/pdf" ||
          file.type === "application/vnd.openxmlformats-officedocument.wordprocessingml.document" ||
          file.type === "application/msword"
        ) {
          // Optionally, show a temporary loading message
          dropArea.textContent = 'Uploading file...';
          const publicLink = await uploadFileToDrive(file);
          dropArea.textContent = 'Drag & Drop Text, PDFs, or Word Files Here';
          if (publicLink) {
            qrInput.value = publicLink;
            updateQRCode(publicLink);
          }
        } else if (file.type.startsWith("text/")) {
          // For plain text files, read the content
          const reader = new FileReader();
          reader.onload = (e) => {
            qrInput.value = e.target.result;
          };
          reader.readAsText(file);
        } else {
          alert("Please drop a valid text, PDF, or Word document.");
        }
      }
    });

    // Show footer when mouse hovers near the bottom of the window
    window.addEventListener('mousemove', (event) => {
      if (event.clientY > window.innerHeight - 50) {
        footer.classList.add('visible');
      } else {
        footer.classList.remove('visible');
      }
    });

    // Toggle the hamburger menu for mobile view
    hamburger.addEventListener('click', () => {
      navMenu.classList.toggle('show');
    });

    // Function to display the requested page section (e.g., Home, About, Contact)
    function showPage(page) {
      const pages = ['qrCodePage', 'aboutPage', 'contactPage', 'explorePage'];
      pages.forEach(p => {
        document.getElementById(p).style.display = (p === page) ? 'block' : 'none';
      });
    }

    browseFiles.addEventListener('click', () => {
      fileInput.click();
    });

    fileInput.addEventListener('change', async (event) => {
      const file = event.target.files[0];
      if (file) {
        if (
          file.type === "application/pdf" ||
          file.type === "application/vnd.openxmlformats-officedocument.wordprocessingml.document" ||
          file.type === "application/msword"
        ) {
          const publicLink = await uploadFileToDrive(file);
          if (publicLink) {
            qrInput.value = publicLink;
            updateQRCode(publicLink);
          }
        } else if (file.type.startsWith("text/")) {
          const reader = new FileReader();
          reader.onload = (e) => {
            qrInput.value = e.target.result;
            updateQRCode(e.target.result);
          };
          reader.readAsText(file);
        } else {
          alert("Please select a valid text, PDF, or Word document.");
        }
      }
    });
  </script>
</body>
</html>
